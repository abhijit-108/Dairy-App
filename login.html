<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dairy App — Login</title>
  <link rel="icon" href="logo.png" type="image/png" />
  <style>
    /* Basic reset */
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    html,body { height: 100%; }

    /* Dark glass background */
    body {
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#071024 0%, #0b1220 50%, #071025 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      color: #e6eef8;
    }

    /* soft ambient glows */
    .bg-glow {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(600px 400px at 10% 10%, rgba(59,130,246,0.10), transparent 12%),
        radial-gradient(500px 400px at 90% 85%, rgba(16,185,129,0.06), transparent 12%);
      z-index: 0;
    }

    /* Card */
    .card {
      position: relative;
      width: 380px;
      max-width: calc(100% - 48px);
      border-radius: 18px;
      padding: 28px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 10px 40px rgba(2,6,23,0.75), inset 0 1px 0 rgba(255,255,255,0.02);
      backdrop-filter: blur(10px) saturate(120%);
      z-index: 1;
      text-align: center;
    }

    .logo {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      object-fit: cover;
      margin: 0 auto 10px;
      box-shadow: 0 6px 18px rgba(59,130,246,0.12);
    }

    h1 { font-size: 20px; margin-bottom: 6px; letter-spacing: 0.6px; }
    .subtitle { font-size: 13px; color: #9fb3d6; margin-bottom: 16px; }

    .guest-btn {
      width: 100%;
      border: 0;
      padding: 10px 12px;
      border-radius: 12px;
      background: linear-gradient(135deg,#235be6,#08a6c2);
      color: white;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(8,166,194,0.14);
      margin-bottom: 14px;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .guest-btn:active { transform: translateY(1px) scale(.996); }

    .user-row {
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      margin-bottom: 14px;
    }
    .user-label {
      padding: 8px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,0.025);
      border: 1px solid rgba(255,255,255,0.03);
      color:#cfe7ff;
      font-weight:600;
      font-size: 14px;
    }

    /* PIN display: bigger masked field */
    .pin-wrap {
      display:flex;
      justify-content:center;
      margin-bottom: 16px;
    }
    .pin {
      width: 230px;
      padding: 12px 16px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.04);
      color: #e6eef8;
      font-weight:700;
      letter-spacing: 6px;
      text-align: center;
      font-size: 20px;
      backdrop-filter: blur(6px);
      user-select: none;
      min-height: 48px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .pin.placeholder { color: #71879d; font-weight:600; letter-spacing: 2px; }

    /* numeric keypad */
    .keyboard {
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 6px;
    }

    .key {
      position: relative;
      padding: 14px 0;
      border-radius: 12px;
      font-weight: 700;
      font-size: 18px;
      border: 0;
      cursor: pointer;
      color: #eaf6ff;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 8px 22px rgba(2,6,23,0.6);
      transition: transform .09s ease, box-shadow .12s ease, background .12s ease;
      overflow: hidden;
    }

    /* ripple container */
    .key .ripple {
      position:absolute;
      left:0; top:0; right:0; bottom:0;
      pointer-events:none;
    }

    .key:active {
      transform: translateY(2px) scale(.985);
      box-shadow: 0 4px 12px rgba(2,6,23,0.65);
    }

    .key.primary {
      background: linear-gradient(135deg,#0f766e,#10b981);
      color: #061213;
      box-shadow: 0 8px 28px rgba(16,185,129,0.18);
    }

    .key.clear {
      background: linear-gradient(135deg, rgba(239,68,68,0.14), rgba(239,68,68,0.06));
      color:#ffd6d6;
    }

    .error {
      color: #ffb4b4;
      font-weight:700;
      margin-top: 12px;
      min-height: 20px;
      font-size: 13px;
    }

    .footer { font-size: 12px; color: #8fa9c8; margin-top: 12px; }

    @media (max-width:420px) {
      .card { padding: 20px; width: 94%; }
      .pin { width: 100%; font-size: 18px; }
    }

  </style>
</head>
<body>
  <div class="bg-glow" aria-hidden="true"></div>

  <div class="card" role="main" aria-labelledby="appTitle">
    <img src="logo.png" alt="" class="logo" />
    <h1 id="appTitle">Dairy App</h1>
    <div class="subtitle">Enter PIN to continue — secure & private</div>

    <button class="guest-btn" id="guestBtn" type="button">Login as Guest</button>

    <div class="user-row" aria-hidden="false">
      <div class="user-label" id="userLabel">User: Abhijit</div>
    </div>

    <!-- hidden email for firebase -->
    <input type="hidden" id="email" value="abhijit722141@gmail.com">

    <!-- visible masked PIN field (readonly to force keypad use) -->
    <div class="pin-wrap">
      <div id="pinDisplay" class="pin placeholder">••••</div>
    </div>

    <!-- keypad -->
    <div class="keyboard" role="application" aria-label="PIN keypad">
      <button class="key" data-key="1" aria-label="1"><span>1</span><span class="ripple"></span></button>
      <button class="key" data-key="2" aria-label="2"><span>2</span><span class="ripple"></span></button>
      <button class="key" data-key="3" aria-label="3"><span>3</span><span class="ripple"></span></button>

      <button class="key" data-key="4" aria-label="4"><span>4</span><span class="ripple"></span></button>
      <button class="key" data-key="5" aria-label="5"><span>5</span><span class="ripple"></span></button>
      <button class="key" data-key="6" aria-label="6"><span>6</span><span class="ripple"></span></button>

      <button class="key" data-key="7" aria-label="7"><span>7</span><span class="ripple"></span></button>
      <button class="key" data-key="8" aria-label="8"><span>8</span><span class="ripple"></span></button>
      <button class="key" data-key="9" aria-label="9"><span>9</span><span class="ripple"></span></button>

      <button class="key clear" data-key="clear" aria-label="clear"><span>Clear</span><span class="ripple"></span></button>
      <button class="key" data-key="0" aria-label="0"><span>0</span><span class="ripple"></span></button>
      <button class="key primary" data-key="enter" aria-label="enter"><span>Login</span><span class="ripple"></span></button>
    </div>

    <div id="error" class="error" role="alert" aria-live="polite"></div>
    <div class="footer">Tip: You can continue as Guest or use your secure PIN.</div>
  </div>

  <!-- Script (Firebase kept, WebAudio for clicks) -->
  <script type="module">
    // Firebase libs (unchanged)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAuhNKygw6dv8jqfNY8qnmIrX-TsLy2jvI",
      authDomain: "dairy-app-abhijit.firebaseapp.com",
      databaseURL: "https://dairy-app-abhijit-default-rtdb.firebaseio.com",
      projectId: "dairy-app-abhijit",
      storageBucket: "dairy-app-abhijit.appspot.com",
      messagingSenderId: "196152880143",
      appId: "1:196152880143:web:bec02170e30932a7d5877a"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();

    // UI refs
    const pinDisplay = document.getElementById('pinDisplay');
    const keys = Array.from(document.querySelectorAll('.key'));
    const errorEl = document.getElementById('error');
    const guestBtn = document.getElementById('guestBtn');

    // PIN state (keeps digits only; masked display)
    let pin = '';

    // Audio (WebAudio) - local tones so no external files required
    let audioCtx = null;
    function initAudioIfNeeded() {
      if (audioCtx) return;
      try {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      } catch (e) {
        audioCtx = null;
      }
    }

    // short click beep
    function playClickTone() {
      if (!audioCtx) return;
      const now = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(950, now); // bright click frequency
      gain.gain.setValueAtTime(0, now);
      gain.gain.linearRampToValueAtTime(0.12, now + 0.001);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.12);
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start(now);
      osc.stop(now + 0.13);
    }

    // success tone
    function playSuccessTone() {
      if (!audioCtx) return;
      const now = audioCtx.currentTime;
      const o1 = audioCtx.createOscillator(), g1 = audioCtx.createGain();
      const o2 = audioCtx.createOscillator(), g2 = audioCtx.createGain();
      o1.type = 'sine'; o2.type = 'sine';
      o1.frequency.setValueAtTime(880, now);
      o2.frequency.setValueAtTime(1320, now);
      g1.gain.setValueAtTime(0.0001, now);
      g1.gain.linearRampToValueAtTime(0.15, now + 0.01);
      g1.gain.exponentialRampToValueAtTime(0.0001, now + 0.45);
      g2.gain.setValueAtTime(0.0001, now);
      g2.gain.linearRampToValueAtTime(0.09, now + 0.01);
      g2.gain.exponentialRampToValueAtTime(0.0001, now + 0.45);
      o1.connect(g1); o2.connect(g2);
      g1.connect(audioCtx.destination); g2.connect(audioCtx.destination);
      o1.start(now); o2.start(now);
      o1.stop(now + 0.46); o2.stop(now + 0.46);
    }

    // error tone
    function playErrorTone() {
      if (!audioCtx) return;
      const now = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'sawtooth';
      osc.frequency.setValueAtTime(220, now);
      gain.gain.setValueAtTime(0.0001, now);
      gain.gain.linearRampToValueAtTime(0.18, now + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.34);
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.start(now);
      osc.stop(now + 0.34);
    }

    // Utility: update masked display: show dots for length, or placeholder when empty
    function refreshPinDisplay() {
      if (!pin) {
        pinDisplay.classList.add('placeholder');
        pinDisplay.textContent = '••••';
      } else {
        pinDisplay.classList.remove('placeholder');
        // show fixed number of dots equal to digits entered (max 6 for safety)
        pinDisplay.textContent = '•'.repeat(pin.length).padEnd(4, ' ');
      }
    }

    // ripple effect helper
    function createRipple(btn, x, y) {
      const r = document.createElement('span');
      const size = Math.max(btn.clientWidth, btn.clientHeight) * 1.4;
      r.style.position = 'absolute';
      r.style.left = (x - btn.getBoundingClientRect().left - size/2) + 'px';
      r.style.top = (y - btn.getBoundingClientRect().top - size/2) + 'px';
      r.style.width = r.style.height = size + 'px';
      r.style.borderRadius = '50%';
      r.style.background = 'rgba(255,255,255,0.06)';
      r.style.transform = 'scale(0)';
      r.style.transition = 'transform 420ms cubic-bezier(.2,.9,.2,1), opacity 420ms';
      r.style.pointerEvents = 'none';
      btn.querySelector('.ripple').appendChild(r);
      requestAnimationFrame(()=> r.style.transform = 'scale(1)');
      setTimeout(()=> { r.style.opacity = '0'; }, 260);
      setTimeout(()=> { r.remove(); }, 700);
    }

    // Enable audio on first user gesture (works with browser autoplay policies)
    function ensureAudioEnabled() {
      if (audioCtx && audioCtx.state === 'running') return;
      initAudioIfNeeded();
      if (!audioCtx) return;
      if (audioCtx.state === 'suspended') {
        audioCtx.resume().catch(()=>{/*ignore*/});
      }
    }

    // key handling
    function onKeyPress(key, eventTarget) {
      ensureAudioEnabled();
      playClickTone();
      errorEl.textContent = '';

      if (key === 'clear') {
        pin = '';
        refreshPinDisplay();
        return;
      }
      if (key === 'enter') {
        attemptLogin();
        return;
      }
      // numeric
      if (pin.length >= 8) return; // guard: max length
      if (/^\d$/.test(key)) {
        pin += key;
        refreshPinDisplay();
      }
    }

    // login attempt logic (keeps original prefix behaviour)
    async function attemptLogin() {
      const email = document.getElementById('email').value;
      const passwordPart2 = pin;
      if (!passwordPart2 || passwordPart2.length === 0) {
        errorEl.textContent = 'Please enter PIN';
        playErrorTone();
        return;
      }
      // show small loading or disable keys while attempt? quick approach: disable
      setKeysDisabled(true);
      try {
        const password = "9775815681" + passwordPart2;
        await signInWithEmailAndPassword(auth, email, password);
        playSuccessTone();
        // give a small delay to let tone play and then redirect
        setTimeout(()=> { window.location.href = 'index.html'; }, 420);
      } catch (err) {
        // friendly error messages like before
        const msg = (err && err.message) ? err.message.toLowerCase() : '';
        if (msg.includes('invalid') || msg.includes('wrong')) {
          errorEl.textContent = 'Wrong password!';
        } else if (msg.includes('missing')) {
          errorEl.textContent = 'Please enter password';
        } else if (msg.includes('attempts')) {
          errorEl.textContent = 'Too many attempts. Try later';
        } else {
          errorEl.textContent = err.message || 'Login failed';
        }
        playErrorTone();
        pin = '';
        refreshPinDisplay();
      } finally {
        setKeysDisabled(false);
      }
    }

    // disable/enable keys
    function setKeysDisabled(disabled) {
      keys.forEach(k => k.disabled = !!disabled);
      guestBtn.disabled = !!disabled;
    }

    // initial display
    refreshPinDisplay();

    // attach events (keyboard + ripple + pointer)
    keys.forEach(btn => {
      btn.addEventListener('pointerdown', (ev) => {
        const key = btn.getAttribute('data-key');
        createRipple(btn, ev.clientX, ev.clientY);
        onKeyPress(key, btn);
      });
      // support keyboard Enter/Space on focused button
      btn.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter' || ev.key === ' ') {
          ev.preventDefault();
          const key = btn.getAttribute('data-key');
          onKeyPress(key, btn);
        }
      });
    });

    // guest button
    guestBtn.addEventListener('click', (ev) => {
      ensureAudioEnabled();
      playClickTone();
      // small UX: redirect immediately
      setTimeout(()=> window.location.href = 'index.html', 120);
    });

    // allow physical keyboard digits & backspace/enter
    window.addEventListener('keydown', (ev) => {
      // allow only when card focused (prevent while typing other things)
      // Accept digits
      if (/^\d$/.test(ev.key)) {
        onKeyPress(ev.key);
      } else if (ev.key === 'Backspace') {
        if (pin.length > 0) {
          pin = pin.slice(0, -1);
          refreshPinDisplay();
          ensureAudioEnabled(); playClickTone();
        }
      } else if (ev.key === 'Enter') {
        onKeyPress('enter');
      }
    });

    // Accessibility: focusable region so keyboard presses feel natural
    document.querySelector('.card').setAttribute('tabindex', '0');

    // small nicety: when user clicks anywhere on card, enable audio immediately
    document.querySelector('.card').addEventListener('pointerdown', () => {
      ensureAudioEnabled();
    }, { once: true });

  </script>
</body>
</html>
