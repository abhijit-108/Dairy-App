<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Database</title>
</head>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .container {
        background: rgba(255, 255, 255, 0.95);
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
        backdrop-filter: blur(10px);
        position: relative;
    }

    .title {
        text-align: center;
        font-size: 32px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 30px;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-bottom: 3px solid #3498db;
        padding-bottom: 10px;
    }

    .datetime-row {
        display: flex;
        gap: 20px;
        margin-bottom: 25px;
    }

    .datetime-group {
        flex: 1;
    }

    .datetime-group {
        position: relative;
    }

    .datetime-group label {
        position: absolute;
        top: -8px;
        left: 15px;
        background: linear-gradient(145deg, #f0f0f0, #d0d0d0);
        color: #555;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 11px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        z-index: 2;
        box-shadow:
            inset 2px 2px 4px rgba(0, 0, 0, 0.1),
            inset -2px -2px 4px rgba(255, 255, 255, 0.8),
            0 1px 3px rgba(0, 0, 0, 0.1);
        text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.8);
    }

    .datetime-group input {
        width: 100%;
        padding: 18px 15px 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        background: #f8f9fa;
        transition: all 0.3s ease;
        box-sizing: border-box;
    }

    .datetime-group input:focus {
        outline: none;
        border-color: #3498db;
        background: white;
        box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
    }

    .name-section {
        margin-bottom: 25px;
        position: relative;
    }

    .name-section label {
        position: absolute;
        top: -8px;
        left: 15px;
        background: linear-gradient(145deg, #f0f0f0, #d0d0d0);
        color: #555;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 11px;
        font-weight: bold;
        z-index: 2;
        box-shadow:
            inset 2px 2px 4px rgba(0, 0, 0, 0.1),
            inset -2px -2px 4px rgba(255, 255, 255, 0.8),
            0 1px 3px rgba(0, 0, 0, 0.1);
        text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.8);
    }

    .name-section select {
        width: 100%;
        padding: 18px 15px 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        background: #f8f9fa;
        color: #2c3e50;
        transition: all 0.3s ease;
        cursor: pointer;
        box-sizing: border-box;
    }

    .name-section select:focus {
        outline: none;
        border-color: #3498db;
        background: white;
        box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
    }

    .input-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 15px;
        margin-bottom: 25px;
    }

    .input-group {
        display: flex;
        flex-direction: column;
        position: relative;
        min-width: 0;
        /* Prevent flex items from overflowing */
    }

    .input-group label {
        position: absolute;
        top: -8px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(145deg, #f0f0f0, #d0d0d0);
        color: #555;
        padding: 4px 8px;
        border-radius: 15px;
        font-size: 11px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        z-index: 2;
        white-space: nowrap;
        max-width: 90%;
        overflow: hidden;
        text-overflow: ellipsis;
        box-shadow:
            inset 2px 2px 4px rgba(0, 0, 0, 0.1),
            inset -2px -2px 4px rgba(255, 255, 255, 0.8),
            0 1px 3px rgba(0, 0, 0, 0.1);
        text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.8);
    }

    .input-group input {
        padding: 18px 12px 12px 12px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        text-align: center;
        background: #f8f9fa;
        transition: all 0.3s ease;
        box-sizing: border-box;
    }

    .input-group input:focus {
        outline: none;
        border-color: #3498db;
        background: white;
        box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
    }

    .rate-total-section {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 20px;
        width: 100%;
        box-sizing: border-box;
    }

    .rate-total-group {
        width: 100%;
        box-sizing: border-box;
    }

    @media (min-width: 601px) {
        .rate-total-section {
            flex-direction: row;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .rate-total-group {
            flex: 1;
            min-width: 0; /* Prevent flex items from overflowing */
        }
    }

    .rate-total-group {
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .rate-total-group label {
        position: absolute;
        top: -8px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(145deg, #f0f0f0, #d0d0d0);
        color: #555;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 11px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        z-index: 2;
        box-shadow:
            inset 2px 2px 4px rgba(0, 0, 0, 0.1),
            inset -2px -2px 4px rgba(255, 255, 255, 0.8),
            0 1px 3px rgba(0, 0, 0, 0.1);
        text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.8);
    }

    .rate-total-group input {
        padding: 18px 15px 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 18px;
        font-weight: 600;
        text-align: center;
        background: #f8f9fa;
        transition: all 0.3s ease;
        box-sizing: border-box;
    }

    .rate-total-group input:focus {
        outline: none;
        border-color: #27ae60;
        background: white;
        box-shadow: 0 0 10px rgba(39, 174, 96, 0.2);
    }

    .calculate-btn {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 2px;
        box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
    }

    .calculate-btn:hover {
        background: linear-gradient(135deg, #229954, #27ae60);
        transform: translateY(-2px);
        box-shadow: 0 15px 30px rgba(39, 174, 96, 0.4);
    }

    .calculate-btn:active {
        transform: translateY(0);
        box-shadow: 0 5px 10px rgba(39, 174, 96, 0.3);
    }

    #backtomain {
        position: absolute;
        top: -15px;
        right: -15px;
        padding: 12px 20px;
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        border: none;
        border-radius: 25px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
    }

    #backtomain:hover {
        background: linear-gradient(135deg, #c0392b, #a93226);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
    }

    .alert {
        display: none;
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        text-align: center;
        font-weight: bold;
        font-size: 16px;
        box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        animation: slideIn 0.3s ease-out;
    }

    .alert.show {
        display: block;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .name-section select {
        width: 100%;
        padding: 18px 15px 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        background: #f8f9fa;
        color: #2c3e50;
        transition: all 0.3s ease;
        cursor: pointer;
        box-sizing: border-box;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .name-section select option {
        font-size: 14px;
        padding: 8px;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    @media (max-width: 600px) {
        .container {
            padding: 25px 15px;
            margin: 10px;
            max-width: 100%;
            width: calc(100vw - 40px);
            box-sizing: border-box;
        }

        .input-grid {
            grid-template-columns: 1fr 1fr 1fr;
            gap: 5px;
            width: 100%;
        }

        .input-group {
            min-height: 65px;
            min-width: 0;
        }

        .input-group input {
            padding: 20px 2px 8px 2px;
            font-size: 13px;
            min-height: 40px;
            width: 100%;
            min-width: 0;
        }

        .input-group label {
            font-size: 7px;
            padding: 1px 4px;
            top: -5px;
            white-space: nowrap;
        }

        .datetime-row {
            flex-direction: column;
            gap: 15px;
        }

        .rate-total-section {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .rate-total-group input {
            padding: 20px 15px 8px 15px;
        }

        .rate-total-group label {
            font-size: 10px;
            top: -6px;
        }

        .title {
            font-size: 22px;
            margin-bottom: 20px;
        }

        .name-section {
            margin-bottom: 20px;
        }

        .name-section select {
            font-size: 12px;
            padding: 18px 10px 8px 10px;
        }

        .name-section label {
            font-size: 9px;
            padding: 2px 8px;
            top: -6px;
        }

        .datetime-group label {
            font-size: 9px;
            padding: 2px 8px;
            top: -6px;
        }

        .datetime-group input {
            padding: 20px 12px 8px 12px;
            font-size: 14px;
        }

        #backtomain {
            top: -12px;
            right: -12px;
            padding: 8px 12px;
            font-size: 12px;
        }
    }
</style>

<body>
    <div class="container">
        <button id="backtomain">Back to Main</button>

        <form action="" name="lol" method="post" id="registrationform">
            <div class="title">Fix Database</div>

            <div class="datetime-row">
                <div class="datetime-group">
                    <label for="customDate">Date</label>
                    <input type="text" id="customDate" name="customDate" placeholder="dd/mm/yy" required maxlength="8">
                </div>
                <div class="datetime-group">
                    <label for="customTime">Time</label>
                    <input type="time" id="customTime" name="customTime" required>
                </div>
            </div>

            <div class="name-section">
                <label for="name">সদস্যর নাম</label>
                <select class="select" id="name" name="NAME" required>
                    <option value="">Select Member</option>
                </select>
            </div>

            <div class="input-grid">
                <div class="input-group">
                    <label for="kg">KG</label>
                    <input type="number" placeholder="" id="kg" step="any" required oninput="rateandtotal();" />
                </div>
                <div class="input-group">
                    <label for="fat">FAT</label>
                    <input type="number" placeholder="" id="fat" step="any" oninput="rateandtotal();" />
                </div>
                <div class="input-group">
                    <label for="snf">SNF</label>
                    <input type="number" placeholder="" id="snf" step="any" required oninput="rateandtotal();" />
                </div>

            </div>

            <div class="rate-total-section">
                <div class="rate-total-group">
                    <label for="rate">Rate</label>
                    <input type="number" placeholder="" id="rate" step="any" required />
                </div>
                <div class="rate-total-group">
                    <label for="total">Total</label>
                    <input type="number" placeholder="" id="total" step="any" required />
                </div>
            </div>

            <button type="button" id="submit" class="calculate-btn"
                onclick="if(validateInput()) { sendEmail();playSound();multiplyNumbers(); }">Calculate</button>

            <div class="alert">Data submitted successfully!</div>

            <audio id="myAudio">
                <source src="button.wav" type="audio/mp3">
            </audio>
        </form>
    </div>

    <script>
        // Format date as dd/mm/yy
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = String(date.getFullYear()).slice(-2);
            return `${day}/${month}/${year}`;
        }

        // Set today's date and current time on page load
        function setTodayDateTime() {
            const now = new Date();
            document.getElementById('customDate').value = formatDate(now);
            
            // Format time as HH:MM for time input
            const currentTime = now.toTimeString().split(' ')[0].substring(0, 5);
            document.getElementById('customTime').value = currentTime;
        }

        async function fetchNames() {
            try {
                const response = await fetch('names.md');
                const data = await response.text();
                const names = data.split('\n').map(line => line.split(' | ')[0].trim()).filter(name => name);

                const nameSelect = document.getElementById('name');
                names.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    // Truncate long names for better display
                    const displayName = name.length > 20 ? name.substring(0, 17) + '...' : name;
                    option.text = displayName;
                    option.title = name; // Show full name on hover
                    nameSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching names:', error);
            }
        }

        // Format date input to ensure dd/mm/yy format
        function formatDateInput(input) {
            // Remove any non-digit characters
            let value = input.value.replace(/\D/g, '');

            // Format as dd/mm/yy
            if (value.length > 2) {
                value = value.substring(0, 2) + '/' + value.substring(2);
            }
            if (value.length > 5) {
                value = value.substring(0, 5) + '/' + value.substring(5, 7);
            }

            // Limit to 8 characters (dd/mm/yy)
            if (value.length > 8) {
                value = value.substring(0, 8);
            }

            input.value = value;
        }

        // Convert dd/mm/yy to Date object
        function parseDate(dateStr) {
            const [day, month, year] = dateStr.split('/').map(Number);
            // Convert 2-digit year to 4-digit (assuming 2000s)
            const fullYear = year < 50 ? 2000 + year : 1900 + year;
            return new Date(fullYear, month - 1, day);
        }

        document.addEventListener('DOMContentLoaded', function () {
            setTodayDateTime();
            fetchNames();

            // Add input event listener for date formatting
            const dateInput = document.getElementById('customDate');
            dateInput.addEventListener('input', function () {
                formatDateInput(this);
            });
            formatDateDisplay();

            // Update date preview when date changes
            document.getElementById('customDate').addEventListener('change', formatDateDisplay);
        });
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAuhNKygw6dv8jqfNY8qnmIrX-TsLy2jvI",
            authDomain: "dairy-app-abhijit.firebaseapp.com",
            databaseURL: "https://dairy-app-abhijit-default-rtdb.firebaseio.com",
            projectId: "dairy-app-abhijit",
            storageBucket: "dairy-app-abhijit.appspot.com",
            messagingSenderId: "196152880143",
            appId: "1:196152880143:web:bec02170e30932a7d5877a"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase();
        const auth = getAuth();

        document.getElementById('registrationform').addEventListener('submit', formSubmit);

        function formSubmit(e) {
            e.preventDefault();
            if (validateInput()) {
                let name = document.querySelector('#name').value;
                let rate = document.querySelector('#rate').value;
                let total = document.querySelector('#total').value;
                let fat = document.querySelector('#fat').value;
                let snf = document.querySelector('#snf').value;
                let kg = document.querySelector('#kg').value;
                let customDate = document.querySelector('#customDate').value;
                let customTime = document.querySelector('#customTime').value;

                let selectedDate = new Date(customDate + 'T' + customTime);
                checkAndSendMessage(name, rate, total, fat, snf, kg, selectedDate);
            } else {
                console.log("Form validation failed. Please correct errors.");
            }
        }

        function validateInput() {
            // Implement validation logic if necessary
            return true;
        }

        function formatDateTime(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const meridiem = hours >= 12 ? 'pm' : 'am';
            const formattedHours = hours % 12 || 12;
            return `${day}/${month}/${year} ${formattedHours}:${minutes}${meridiem}`;
        }

        function getTimePeriod(hours) {
            if (hours >= 3 && hours < 11) {
                return "সকাল";
            } else if (hours >= 12 && hours < 15) {
                return "দুপুর";
            } else {
                return "সন্ধ্যা";
            }
        }

        async function checkAndSendMessage(name, rate, total, fat, snf, kg, selectedDate) {
            const formattedDate = `${selectedDate.getDate()}-${selectedDate.getMonth() + 1}-${selectedDate.getFullYear()}`;
            const formattedTime = formatDateTime(selectedDate);
            const personName = name.toLowerCase().replace(/\s+/g, '-');
            const timePeriod = getTimePeriod(selectedDate.getHours());
            const personRef = ref(database, `records/${formattedDate}/${personName}/${timePeriod}`);

            try {
                await set(personRef, {
                    name: name,
                    rate: rate,
                    total: total,
                    fat: fat,
                    snf: snf,
                    kg: kg,
                    timestamp: formattedTime
                });
                document.querySelector('.alert').classList.add('show');
                setTimeout(function () {
                    document.querySelector('.alert').classList.remove('show');
                }, 3000);
            } catch (error) {
                alert(error);
            }
        }

        // Make functions global for onclick handlers
        window.validateInput = validateInput;
        window.checkAndSendMessage = checkAndSendMessage;
    </script>

    <script>
        // Get the button element
        var billButton = document.getElementById('backtomain');

        // Add a click event listener to the button
        billButton.addEventListener('click', function () {
            // Redirect to bill.html
            window.location.href = 'index.html';
        });
    </script>
    <script src="js/rate.js?v=1.0.2"></script>

</body>

</html>